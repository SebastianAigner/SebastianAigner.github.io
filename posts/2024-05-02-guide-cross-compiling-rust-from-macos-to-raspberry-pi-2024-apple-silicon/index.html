<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta property="og:title" content="Guide: Cross-compiling Rust from macOS to Raspberry Pi (2024, Apple Silicon)"><meta property="og:description" content="This guide builds on the guide from Amarit Rathie, which has been an indispensible resource in getting me started with cross-compilation at all. Mine has been updated for the latest versions of macOS at the time, and I&rsquo;ve tried it on an M2 Mac &ndash; here, I&rsquo;m the steps (and workarounds) required to get it to work for me &ndash; explanations are kept short, and I encourage you to reference the original blogpost to get a better understanding of what&rsquo;s going on."><meta property="og:type" content="article"><meta property="og:url" content="https://sebi.io/posts/2024-05-02-guide-cross-compiling-rust-from-macos-to-raspberry-pi-2024-apple-silicon/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-02T23:31:00+00:00"><meta property="article:modified_time" content="2024-05-02T23:31:00+00:00"><title>Guide: Cross-compiling Rust from macOS to Raspberry Pi (2024, Apple Silicon) | Sebastian Aigner</title><link rel=stylesheet href=https://sebi.io/sass/main.1062dd691b84b3ea042cce5aecb22abbae6d1a58288b48fbcb72443c8f1930dd.css integrity="sha256-EGLdaRuEs+oELM5a7LIqu65tGlgoi0j7y3JEPI8ZMN0=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header class=site-header><div class=wrapper><a class=site-title rel=author href=/>Sebastian Aigner</a><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg viewBox="0 0 18 15" width="18" height="15"><path d="M18 1.484c0 .82-.665 1.484-1.484 1.484H1.484C.665 2.969.0 2.304.0 1.484.0.665.665.0 1.484.0h15.032C17.335.0 18 .665 18 1.484zm0 6.032C18 8.335 17.335 9 16.516 9H1.484C.665 9 0 8.335.0 7.516c0-.82.665-1.484 1.484-1.484h15.032C17.335 6.031 18 6.696 18 7.516zm0 6C18 14.335 17.335 15 16.516 15H1.484C.665 15 0 14.335.0 13.516c0-.82.665-1.483 1.484-1.483h15.032C17.335 12.031 18 12.695 18 13.516z"/></svg></span></label><div class=trigger><a class=page-link href=/>Home</a>
<a class=page-link href=/micro/>Microblah</a>
<a class=page-link aria-current=true class=ancestor href=/posts/>Posts</a>
<a class=page-link href=/tags/>Tags</a></div></nav></div></header><main class=page-content aria-label=Content><div class=wrapper><header class=post-header><h1 class="post-title p-name" itemprop="name headline">Guide: Cross-compiling Rust from macOS to Raspberry Pi (2024, Apple Silicon)</h1><p class=post-meta><time class=dt-published datetime=2024-05-02T23:31:00+00:00>May 2, 2024</time></p></header><div class="post-content e-content"><blockquote><p>This guide builds
on <a href=https://amritrathie.vercel.app/posts/2020/03/06/cross-compiling-rust-from-macos-to-raspberry-pi/#getting-a-linker>the guide from Amarit Rathie</a>,
which has been an indispensible resource in getting me started with cross-compilation at all.
Mine has been updated for the latest versions of macOS at the time, and I&rsquo;ve tried it on an M2 Mac &ndash; here, I&rsquo;m the
steps (and workarounds) required to get it to work for me &ndash; explanations are kept short, and I encourage you to reference the original blogpost to get a better understanding of what&rsquo;s going on.</p></blockquote><h2 id=adding-the-compilation-target>Adding the compilation target</h2><p>I&rsquo;m on a 32-Bit Raspberry Pi 3, so I did the following:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rustup target add armv7-unknown-linux-musleabihf
</span></span></code></pre></div><p>I assume that a 64-bit Raspberry Pi needs a different cross-compilation setup. If you have info on this, drop me a line,
and I&rsquo;ll happily edit it here!</p><h2 id=setup-linker>Setup linker</h2><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install arm-linux-gnueabihf-binutils
</span></span></code></pre></div><h2 id=setup-musl-cross-compilation-toolchain>Setup musl cross compilation toolchain</h2><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install FiloSottile/musl-cross/musl-cross
</span></span><span style=display:flex><span>brew reinstall musl-cross --without-x86_64 --without-aarch64 --with-arm-hf
</span></span></code></pre></div><p>(This is a workaround
for the <a href=https://github.com/FiloSottile/homebrew-musl-cross/issues/45>brew issue</a> <code>invalid option: --without-x86_64</code>)</p><p>Using a cross-compilation toolchain fixes issues
like <code>error occurred: Failed to find tool. Is `arm-linux-musleabihf-gcc` installed?</code>, which I encountered on my first
attempts.</p><h2 id=setup-linker-1>Setup linker</h2><p>Put this in your <code>.cargo/config</code>:</p><pre tabindex=0><code>[target.armv7-unknown-linux-musleabihf]
linker = &#34;arm-linux-gnueabihf-ld&#34;
ar = &#34;arm-linux-gnueabihf-ar&#34; # optional
</code></pre><p>As Amirit mentions
in <a href=https://amritrathie.vercel.app/posts/2020/03/06/cross-compiling-rust-from-macos-to-raspberry-pi/#connecting-components>his guide</a>,
you can either do this for the current project (the option I went for), or alternatively specify it globally
in <code>~/.cargo/config</code>.</p><h2 id=build-your-app>Build your app</h2><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cargo build --target armv7-unknown-linux-musleabihf
</span></span></code></pre></div><h2 id=openssl-issues>OpenSSL issues</h2><p>Encountered issue with
OpenSSL: <code>Could not find directory of OpenSSL installation, and this `-sys` crate cannot proceed without this knowledge.</code>
I don&rsquo;t have a fix for it, but there is a workaround: use a different SSL implementation. <code>reqwest</code>, for example,
supports <code>rustls</code> out of the box. Remember to turn off <code>default-features</code>, otherwise this won&rsquo;t work!</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span>reqwest = { version = <span style=color:#b8bb26>&#34;0.11.23&#34;</span>, features = [<span style=color:#b8bb26>&#34;json&#34;</span>, <span style=color:#b8bb26>&#34;rustls&#34;</span>], default-features = <span style=color:#fe8019>false</span> }
</span></span></code></pre></div><p>Enjoy building some oxidized binaries for your Raspberry!</p></div></div></main><footer><footer class="site-footer h-card"><data class=u-url href></data><div class=wrapper><div class=footer-col-wrapper><div class=footer-col><p class=feed-subscribe><svg class="svg-icon orange"/><span>Subscribe</span></a></p><ul class=contact-list></ul></div><div class=footer-col><p>Thanks for stopping by my corner of the internet :)</p></div></div></div></footer></footer></body></html>