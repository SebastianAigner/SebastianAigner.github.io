<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Hexagonal Grids | Sebastian Aigner</title><link rel=stylesheet href=https://sebi.io/sass/main.1062dd691b84b3ea042cce5aecb22abbae6d1a58288b48fbcb72443c8f1930dd.css integrity="sha256-EGLdaRuEs+oELM5a7LIqu65tGlgoi0j7y3JEPI8ZMN0=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header class=site-header><div class=wrapper><a class=site-title rel=author href=/>Sebastian Aigner</a><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg viewBox="0 0 18 15" width="18" height="15"><path d="M18 1.484c0 .82-.665 1.484-1.484 1.484H1.484C.665 2.969.0 2.304.0 1.484.0.665.665.0 1.484.0h15.032C17.335.0 18 .665 18 1.484zm0 6.032C18 8.335 17.335 9 16.516 9H1.484C.665 9 0 8.335.0 7.516c0-.82.665-1.484 1.484-1.484h15.032C17.335 6.031 18 6.696 18 7.516zm0 6C18 14.335 17.335 15 16.516 15H1.484C.665 15 0 14.335.0 13.516c0-.82.665-1.483 1.484-1.483h15.032C17.335 12.031 18 12.695 18 13.516z"/></svg></span></label><div class=trigger><a class=page-link href=/>Home</a>
<a class=page-link aria-current=true class=ancestor href=/posts/>Posts</a>
<a class=page-link href=/tags/>Tags</a></div></nav></div></header><main class=page-content aria-label=Content><div class=wrapper><header class=post-header><h1 class="post-title p-name" itemprop="name headline">Hexagonal Grids</h1><p class=post-meta><time class=dt-published datetime=2018-01-04T01:23:43+00:00>January 4, 2018</time></p></header><div class="post-content e-content"><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script><p>I was spending one of the recent days in the Loretta Bar here in Munich together with Alex, and we worked on a few tasks of the 2017 edition of Advent of Code. I was infatuated with the last task we worked on, the <a href=http://adventofcode.com/2017/day/11>Day 11</a> challenge. You are supposed to find the distance of a position in a <a href=https://en.wikipedia.org/wiki/Hexagonal_tiling>Hex Grid</a> based on a path description. I had already read a few articles regarding hexagonal grids, because I feel it is one of the less intuitive data structures, but none of them really made me understand the topic extremely well. I decided to just grab a pen and doodle away at a napkin and (later on) a few pieces of paper, scribbling around and trying to figure things out. After I had managed to build an (albeit inefficient) solution for myself, I set out to understand more about the topic. When I managed to have somewhat of a personal breakthrough in understanding, and felt a lot better reasoning about the topic, I decided it would be time to improve upon the visualisations that I had seen on other blogs like <a href=https://www.redblobgames.com/grids/hexagons/>Redblobgames</a>. They&rsquo;re still a great read any heavily recommended, but I thought I&rsquo;d try my hand at one of these as well. So, amidst what seems like a heavy outage on the internet (with a very spotty connection), I managed to glue together a small demo. Because we all love interactivity, I&rsquo;m going to throw the demo in first, and the rest of the text later.</p><h3 id=interactive-demo>Interactive demo</h3><script src=/assets/unity_hexagons/TemplateData/UnityProgress.js></script>
<script src=/assets/unity_hexagons/Build/UnityLoader.js></script>
<script>var gameInstance=UnityLoader.instantiate("gameContainer","/assets/unity_hexagons/Build/newbuilds.json",{onProgress:UnityProgress})</script><div class=webgl-content><div id=gameContainer style=width:100%;height:423px></div></div>This demo was built on one evening after being kept awake by one too many please-allow-me-to-stay-here-longer-espressos in the caf√©. Thanks for letting us stay!<h3 id=on-hexagonal-grids>On Hexagonal Grids</h3><p>Unlike regular grids, I&rsquo;ve struggled a bit at first with understanding how I would map hexagons to arrays. I&rsquo;ve since realised that you can easily map hexagons into 3 dimensions, and even two dimensions isn&rsquo;t a problem. The general idea that this approach is following is cube coordinates. If you play around with the demo (and maybe switch the camera), you&rsquo;ll quickly see that looked at from the right angle, a diagonal &ldquo;plane&rdquo; of 3d cubes looks an awful lot like a hex grid. This is what we are going to use to reason about how to distribute coordinates, measure distances, and so on.</p><h4 id=coordinates-and-constraints>Coordinates (and Constraints)</h4><p>To make our lives a little easier, we choose the plane that satisfies the basic constraint</p><p>$$x + y + z = 0$$</p><p>If you play around with the interactive widget up there, you&rsquo;ll quickly realize that all coordinates on the plane displayed fulfill exactly that equation. It should also give you an intuitive idea what parameters should change when you perform a move in a direction.</p><h4 id=distances>Distances</h4><p>The 3D representation allows us to easily reason about distances in the grid. You can see that to each neighbouring <em>cube</em>, the manhattan distance is 2. In the <em>hex grid</em>, the distance would be one. Check for yourself that this is correct for all neighbours of the initial \(0,0,0\) coordinate.</p><p>Thus, we quickly arrive at a concise formula for determining distances of hexagons in the grid in relation to the origin:</p><p>$$d = \frac{|x|+|y|+|z|}{2}$$</p><h4 id=the-obsolete-third-axis>The obsolete third axis</h4><p>But, we can go even further. If we can assume that the formula \(x+y+z = 0\) holds for all our cubes, can simply do some middle school maths and arrive at</p><p>$$z = -(x+y)$$</p><p>So what does this tell us? Since the \(z\) coordinate is merely a function of \(x\) and \(y\), it does not need to be saved in memory, but can be calculated on demand (when it makes sense). This also means that our distance is only dependent on the values of \(x\) and \(y\):</p><p>$$d = \frac{|x|+|y|+ |-(x+y)|}{2} = \frac{|x|+|y|+ |x+y|}{2}$$</p><p>If we go back to the graphical representation again (after having developed some intuition for it), we can see that this makes an extreme amount of sense. Observe how each \(x,y\) coordinate pair already uniquely identifies a cube on our plane. The formula for \(z\) also holds; again, staring intently at the cubes and axis offsets should give you an intuitive understanding to why that is (<em>Looking at it from the default camera perspective, you should realise that moving one cube away from the camera (into the space) always has to increment the \(z\) coordinate by one due to the staircase like nature of our plane; conversely, you need to decrease your \(z\) coordinate whenever you move towards the camera</em>)</p><p>So, we can store all grid coordinates in only two dimensions - that&rsquo;s going to make building implementations a lot easier!</p><h4 id=a-demo-implementation>A demo implementation</h4><p>In my <a href=https://github.com/SebastianAigner/advent-of-code-2017-ocaml/blob/master/day11/Day11.kt>Advent of Code</a> repository, you can find two implementations for the <code>HexVector</code> interface which I decided needed to be implemented in order to solve the task given by the AoC challenge. The first version, <code>HexVector3</code>, is a quite low performance prototype that I came up with then and there in the caf√©. It uses a process of <em>coordinate normalisation</em> (leveraging the fact that certain pairs of distances can be fused together into other coordinates, as to always obtain the correct manhattan distance).</p><p>The second version, <code>HexVector2</code>, implements the same interface using only two coordinates, while also allowing a conversion to <code>HexVector3</code>.</p><p>It&rsquo;s coding challenge code, so it&rsquo;s not the most polished thing in the world, but I&rsquo;m sure it&rsquo;ll get the point across üòÅ</p><h4 id=further-reading>Further reading</h4><p>This is by no means a complete guide on how to work with hex grids, and it&rsquo;s obviously not supposed to be. It should merely serve as some additional material for those who enjoy interactive visualisations. Hope it helps some of you! If you want to know more about hexagonal grids, I suggest you have a look at these two resources (amongst whatever else you will find on your quest):</p><ul><li><a href=https://www.redblobgames.com/grids/hexagons/>Redblobgames</a></li><li><a href=http://keekerdc.com/2011/03/hexagon-grids-coordinate-systems-and-distance-calculations/>Keekerdc</a></li></ul><h3 id=how-this-demo-is-made>How this Demo is made</h3><p>I first wanted to have a non-interactive 3D model so I could just have a look at it properly (looking on crumpled papers with lines all over the place trying to indicate the third dimension got tiring after a while), so I fired up blender, which is when I had the idea that I could also use a realtime 3D game engine to visualise what I had in mind. I&rsquo;d already played around with Unity a bit beforehand, and a demo world was quickly assembled. I grabbed myself a camera controller script that allows orbiting and zooming, and built a script that would highlight the cube/hex that the mouse is currently resting on. I&rsquo;ve had some trouble getting the line renderer to work (which is responsible for drawing the coordinates), but after a short change in the materials setting, that worked as well. After that, I only had to figure out how to properly scale the UI, and was able to export once and for all!</p><p>Unity is probably a bit overkill for the amount of things that are actually happening in the demo, but it allowed me to do some very rapid and caffeine driven prototyping. ‚òï</p><p>Also, as a small easter egg: the backdrop/skybox is my old office where I worked at TUM - just if anybody is interested in that üòä.</p></div></div></main><footer><footer class="site-footer h-card"><data class=u-url href></data><div class=wrapper><div class=footer-col-wrapper><div class=footer-col><p class=feed-subscribe><svg class="svg-icon orange"/><span>Subscribe</span></a></p><ul class=contact-list></ul></div><div class=footer-col><p>Thanks for stopping by my corner of the internet :)</p></div></div></div></footer></footer></body></html>