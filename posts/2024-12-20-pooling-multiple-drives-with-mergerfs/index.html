<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Pooling multiple drives on my Raspberry Pi with mergerfs | Sebastian Aigner</title><link rel=stylesheet href=https://sebi.io/sass/main.1062dd691b84b3ea042cce5aecb22abbae6d1a58288b48fbcb72443c8f1930dd.css integrity="sha256-EGLdaRuEs+oELM5a7LIqu65tGlgoi0j7y3JEPI8ZMN0=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header class=site-header><div class=wrapper><a class=site-title rel=author href=/>Sebastian Aigner</a><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg viewBox="0 0 18 15" width="18" height="15"><path d="M18 1.484c0 .82-.665 1.484-1.484 1.484H1.484C.665 2.969.0 2.304.0 1.484.0.665.665.0 1.484.0h15.032C17.335.0 18 .665 18 1.484zm0 6.032C18 8.335 17.335 9 16.516 9H1.484C.665 9 0 8.335.0 7.516c0-.82.665-1.484 1.484-1.484h15.032C17.335 6.031 18 6.696 18 7.516zm0 6C18 14.335 17.335 15 16.516 15H1.484C.665 15 0 14.335.0 13.516c0-.82.665-1.483 1.484-1.483h15.032C17.335 12.031 18 12.695 18 13.516z"/></svg></span></label><div class=trigger><a class=page-link href=/>Home</a>
<a class=page-link href=/micro/>Microblah</a>
<a class=page-link aria-current=true class=ancestor href=/posts/>Posts</a>
<a class=page-link href=/tags/>Tags</a></div></nav></div></header><main class=page-content aria-label=Content><div class=wrapper><header class=post-header><h1 class="post-title p-name" itemprop="name headline">Pooling multiple drives on my Raspberry Pi with mergerfs</h1><p class=post-meta><time class=dt-published datetime=2024-12-20T00:00:01+00:00>December 20, 2024</time></p></header><div class="post-content e-content"><p>My homelab setup is a bit of a mix-and-match of whatever hardware I happen to have lying around. Likewise, since I mostly run strange little experiments in my home setup, my requirements change frequently. Here&rsquo;s one such requirement:</p><p><strong>An app I built needs more storage than I have on the external HDD that&rsquo;s currently attached to my Raspberry Pi.</strong></p><p>I did have another, smaller HDD that wasn&rsquo;t seeing any use, so I looked into ways of somehow fusing the two drives together, essentially extending storage across two heterogeneous drives.</p><p>This took a bit of research: <a href=https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-multi-drive.html>MinIO</a> can do single-node multi-drive, but then I would first of all have to move my app to use object storage instead of just writing to disk &ndash; and that&rsquo;s just extra work. Additionally, MinIO doesn&rsquo;t like mixed drives.</p><p>I looked around for a bit further, taking a look at <a href=https://seaweedfs.com/>seaweedfs</a> for example, but I didn&rsquo;t quite feel the vibe.</p><h2 id=enter-mergerfs>Enter <code>mergerfs</code></h2><p><a href=https://github.com/trapexit/mergerfs><code>mergerfs</code></a> self-describes as a &ldquo;union filesystem&rdquo;. Understandably, because that&rsquo;s exactly what it is: It allows you to create a mount that acts as a single drive, but actually distributes data on however many underlying drives you have configured. What&rsquo;s more, it allows this even when the drives already have data!</p><p>This was exactly what I needed for my case. Admittedly, the README is a bit intimidating (it&rsquo;s extremely well documented), but I still took a stab at it. Together with the easily digestible description over at <a href=https://perfectmediaserver.com/02-tech-stack/mergerfs/>perfectmediaserver.com</a>, it was pretty simple to actually configure the entire thing. The full process for my Raspberry Pi 4:</p><ul><li>Find out what OS I&rsquo;m running: <code>cat /etc/os-release</code></li><li>Pick the appropriate package from the <a href=https://github.com/trapexit/mergerfs/releases>release page</a> (partially collapsed list!) &ndash; for me, it was <code>mergerfs_2.40.2.debian-bullseye_arm64.deb</code></li><li><code>wget</code> it from the Raspberry Pi</li><li>Install via <code>sudo dpkg -i mergerfs_2.40.2.debian-bullseye_arm64.deb</code></li><li>Remember that my drives get automounted into <code>/media/pi/...</code></li><li>Drop a line into <code>/etc/fstab</code>:</li></ul><p><code>/media/pi/89648fb1-9098-4086-8ed2-ae23c0990592:/media/pi/cdbaad22-2440-4f37-ba73-d5a12ca47ba3 /mnt/extdrivesuperset mergerfs cache.files=auto-full,dropcacheonclose=true,category.create=mfs 0 0</code></p><ul><li>Make doubly and triply sure that there is no trailing slash in the path for the two drives.</li><li>Reboot & enjoy!</li></ul><p>This uses the flags recommended by the README for <code>sqlite</code> support (<code>mmap</code>). So far, that&rsquo;s been going great, and I&rsquo;ve been enjoying a little bit more extra space! If I happen to stumble onto another drive that doesn&rsquo;t have much use, I might also just plug it into my <code>mergerfs</code> setup!</p></div></div></main><footer><footer class="site-footer h-card"><data class=u-url href></data><div class=wrapper><div class=footer-col-wrapper><div class=footer-col><p class=feed-subscribe><svg class="svg-icon orange"/><span>Subscribe</span></a></p><ul class=contact-list></ul></div><div class=footer-col><p>Thanks for stopping by my corner of the internet :)</p></div></div></div></footer></footer></body></html>