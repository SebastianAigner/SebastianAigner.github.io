<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Hosting Kotlin/JS on GitHub Pages via GitHub Actions | Sebastian Aigner</title><link rel=stylesheet href=https://sebi.io/sass/main.1062dd691b84b3ea042cce5aecb22abbae6d1a58288b48fbcb72443c8f1930dd.css integrity="sha256-EGLdaRuEs+oELM5a7LIqu65tGlgoi0j7y3JEPI8ZMN0=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header class=site-header><div class=wrapper><a class=site-title rel=author href=/>Sebastian Aigner</a><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg viewBox="0 0 18 15" width="18" height="15"><path d="M18 1.484c0 .82-.665 1.484-1.484 1.484H1.484C.665 2.969.0 2.304.0 1.484.0.665.665.0 1.484.0h15.032C17.335.0 18 .665 18 1.484zm0 6.032C18 8.335 17.335 9 16.516 9H1.484C.665 9 0 8.335.0 7.516c0-.82.665-1.484 1.484-1.484h15.032C17.335 6.031 18 6.696 18 7.516zm0 6C18 14.335 17.335 15 16.516 15H1.484C.665 15 0 14.335.0 13.516c0-.82.665-1.483 1.484-1.483h15.032C17.335 12.031 18 12.695 18 13.516z"/></svg></span></label><div class=trigger><a class=page-link href=/>Home</a>
<a class=page-link aria-current=true class=ancestor href=/posts/>Posts</a>
<a class=page-link href=/tags/>Tags</a></div></nav></div></header><main class=page-content aria-label=Content><div class=wrapper><header class=post-header><h1 class="post-title p-name" itemprop="name headline">Hosting Kotlin/JS on GitHub Pages via GitHub Actions</h1><p class=post-meta><time class=dt-published datetime=2021-02-05T19:33:57+00:00>February 5, 2021</time></p></header><div class="post-content e-content"><p><a href=https://pages.github.com/>GitHub Pages</a> is an easy way to <strong>host your Kotlin/JS application</strong> - and in combination with the <strong>continuous integration</strong> service <a href=https://github.com/features/actions>GitHub Actions</a>, you can easily set up a smooth development (and deployment!) experience for your projects. Read on to learn how you can <strong>build and test your application on GitHub&rsquo;s CI</strong>, and get your <strong>Kotlin/JS web apps published for free</strong>.</p><p>In this post, we are going to configure GitHub Actions and Pages so that <strong>new code</strong> pushed to our repository or added via pull request <strong>is automatically validated</strong> (by having the project built and our tests run on GitHub&rsquo;s servers), and code pushed to the main branch of our project is automatically made <strong>available to the public</strong> (by generating and publishing production artifacts of our app).</p><p>To achieve this, we are going to:</p><ul><li><a href=#sample-setup>Set up a quick Kotlin/JS project</a></li><li><a href=#github-integration>Share its code on GitHub</a> (via IntelliJ IDEA&rsquo;s Git integration)</li><li><a href=#gh-action-setup>Set up GitHub Actions&rsquo; workflow YAML</a></li><li><a href=#gh-pages-setup>Set up GitHub pages to work with the result of our Actions workflow</a></li></ul><p><strong>If you already know the basics, and want to skip straight to the configuration section, <a href=#gh-action-setup>click here</a> – or <a href=https://github.com/SebastianAigner/kotlin-js-on-gh-pages>find the sample project directly on GitHub</a></strong></p><h2 id=setting-up-our-sample-kotlinjs-application-a-namesample-setup>Setting up our sample Kotlin/JS application <a name=sample-setup></h2><p>To <em>deploy</em> a project, we must first <em>have</em> a project. For this demo, I will use an <strong>example generated via project wizard</strong> – if you already have a Kotlin/JS application you would like to deploy, feel free to skip ahead and use it instead.</p><p>A boilerplate Kotlin/JS project is quickly generated in <a href=https://www.jetbrains.com/idea/>IntelliJ IDEA</a> by navigating to File | New | Project&mldr;, selecting &ldquo;Kotlin&rdquo; in the sidebar, and choosing a <strong>project template</strong> in the &ldquo;Kotlin/JS&rdquo; section (I&rsquo;m choosing a React project). We just need to make sure that a Project JDK is selected. For everything else, the default settings are fine and don&rsquo;t need to be adjusted:</p><p><img src=/assets/kotlin-js-on-gh-pages/1nzk5keyrms4u7bh619e.png alt=new-project-wizard></p><p>Now that we have a basic project, let&rsquo;s start by <strong>getting it on GitHub</strong> - creating a repository and pushing our code.</p><h2 id=putting-our-code-on-github-a-namegithub-integrationa>Putting our code on GitHub <a name=github-integration></a></h2><p>We could, of course, use <a href=https://guides.github.com/activities/hello-world/#repository>GitHub&rsquo;s web interface</a> to set up our repository, and wire up our local repository manually – but <strong><a href=https://www.jetbrains.com/help/idea/version-control-integration.html>IntelliJ IDEA&rsquo;s Version Control Integration</a></strong> makes it <strong>even smoother</strong> to move our project code into a new GitHub Repository. We simply select &ldquo;<strong>Share Project on GitHub</strong>&rdquo; in the &ldquo;VCS&rdquo; tab.</p><p><img src=/assets/kotlin-js-on-gh-pages/e5y09kdv0ube2dmztwq9.png alt="share project on github"></p><p>If this is your first time using this feature, IntelliJ IDEA might ask you to <strong>authenticate</strong> using your GitHub account. You then get to specify your repository name, its visibility (private/public), and can provide a short description that will show up on GitHub:</p><p><img src=/assets/kotlin-js-on-gh-pages/i42fc1w8jug5l95wafiv.png alt="share proj"></p><p>Once confirmed, IntelliJ IDEA will create a GitHub project for you, and show you the &ldquo;Add Files For Initial Commit&rdquo; window, which we can simply accept by pressing &ldquo;Add&rdquo;:</p><p><img src=/assets/kotlin-js-on-gh-pages/29g49u26awwu8ebz8ig3.png alt="initial commit including gitignore"></p><p>As you might have noticed, IntelliJ IDEA makes our life a bit easier here by <strong>auto-generating</strong> a default set of <code>.gitignore</code> files, making sure that any files which shouldn&rsquo;t be checked into source control (such as build artifacts or local configurations) are <strong>correctly ignored</strong>.</p><p>Once the commit is finished, we see a small notification bubble containing a <strong>link to our GitHub repository</strong>:</p><p><img src=/assets/kotlin-js-on-gh-pages/st0uwzx0v3qi9s66k4w6.png alt=success></p><h2 id=setting-up-github-actions-a-namegh-action-setupa>Setting up GitHub Actions <a name=gh-action-setup></a></h2><p>Time to set up GitHub Actions! Actions will be responsible for <strong>building and testing</strong> our project – turning our Kotlin source files into <code>.js</code> and <code>.html</code> artifacts, running any unit tests we might have, and copying files into the right location for deployment on GitHub Pages (a branch called <code>gh-pages</code> by convention). We configure Actions using so-called <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions><strong>workflows</strong></a>, which are YAML configuration files containing instructions on how to transform and build code.</p><p>GitHub looks for workflows in the <code>.github/workflows</code> directory, so let&rsquo;s create this directory structure at our project&rsquo;s root. Inside, let&rsquo;s create a new file called <code>build-and-publish-kjs.yml</code>, and add the following configuration to it:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fb4934>name</span>: Build and Publish
</span></span><span style=display:flex><span><span style=color:#fb4934>on</span>: [ push, pull_request ]
</span></span><span style=display:flex><span><span style=color:#fb4934>jobs</span>:
</span></span><span style=display:flex><span><span style=color:#fb4934>build</span>:
</span></span><span style=display:flex><span><span style=color:#fb4934>name</span>: Test and Build
</span></span><span style=display:flex><span><span style=color:#fb4934>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span><span style=color:#fb4934>steps</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic># Setup Java 1.8 environment for the next steps</span>
</span></span><span style=display:flex><span>- <span style=color:#fb4934>name</span>: Setup Java
</span></span><span style=display:flex><span><span style=color:#fb4934>uses</span>: actions/setup-java@v1
</span></span><span style=display:flex><span><span style=color:#fb4934>with</span>:
</span></span><span style=display:flex><span><span style=color:#fb4934>java-version</span>: <span style=color:#d3869b>1.8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic># Check out current repository</span>
</span></span><span style=display:flex><span>- <span style=color:#fb4934>name</span>: Fetch Sources
</span></span><span style=display:flex><span><span style=color:#fb4934>uses</span>: actions/checkout@v2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic># Build application</span>
</span></span><span style=display:flex><span>- <span style=color:#fb4934>name</span>: Test and Build
</span></span><span style=display:flex><span><span style=color:#fb4934>run</span>: ./gradlew build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#928374;font-style:italic># If main branch update, deploy to gh-pages</span>
</span></span><span style=display:flex><span>- <span style=color:#fb4934>name</span>: Deploy
</span></span><span style=display:flex><span><span style=color:#fb4934>if</span>: github.ref == &#39;refs/heads/master&#39; || github.ref == &#39;refs/heads/main&#39;
</span></span><span style=display:flex><span><span style=color:#fb4934>uses</span>: JamesIves/github-pages-deploy-action@3.7.1
</span></span><span style=display:flex><span><span style=color:#fb4934>with</span>:
</span></span><span style=display:flex><span><span style=color:#fb4934>GITHUB_TOKEN</span>: ${{ secrets.GITHUB_TOKEN }}
</span></span><span style=display:flex><span><span style=color:#fb4934>BRANCH</span>: gh-pages <span style=color:#928374;font-style:italic># The branch the action should deploy to.</span>
</span></span><span style=display:flex><span><span style=color:#fb4934>FOLDER</span>: build/distributions <span style=color:#928374;font-style:italic># The folder the action should deploy.</span>
</span></span><span style=display:flex><span><span style=color:#fb4934>CLEAN</span>: <span style=color:#fe8019>true</span> <span style=color:#928374;font-style:italic># Automatically remove deleted files from the deploy branch</span>
</span></span></code></pre></div><h3 id=understanding-our-action-yaml>Understanding our Action YAML</h3><p>We could just use this configuration as is, and move on to the next step – but it&rsquo;s always good to try and understand what&rsquo;s going on in our project. And while the YAML configuration reads quite naturally, I still want to quickly look at this configuration file section by section (Additionally, feel free to consult the <a href=https://docs.github.com/en/actions/learn-github-actions>GitHub Actions documentation</a> for more information):</p><ul><li>We first give our workflow a <code>name</code> – in this case, <code>Build and Publish</code>.</li><li>Next, we define the triggers for this workflow – what events <strong>kick off</strong> this process. Because we want to make sure that pushed code always compiles, and that pull requests are also fine, we set the value to <code>push</code> and <code>pull_request</code>.</li><li>Next, we define a <code>job</code>, which <strong>groups</strong> the different steps we want to run in a given environment (in our case, <code>ubuntu-latest</code>).</li><li>Now, we define the different <code>steps</code> our build needs to go through:</li><li>The Kotlin compiler needs Java to be present, so we use a <a href=https://github.com/actions/setup-java>predefined GitHub Action</a> to <strong>install Java <code>1.8</code></strong>.</li><li>We use <a href=https://github.com/actions/checkout>another predefined Action</a> to <strong>check out the code</strong> for our project.</li><li>We run the <code>./gradlew build</code> command. <code>build</code> is a <strong>standard lifecycle</strong> task for Kotlin/JS projects which installs all dependencies from npm and Gradle, compiles the application, and runs any tests included in the project.</li><li>Lastly, we use <a href=https://github.com/JamesIves/github-pages-deploy-action>another Action</a> to <strong>deploy our project</strong> to GitHub Pages – but <strong>only if the workflow is running on the <code>master</code> or <code>main</code> branch</strong> (we don&rsquo;t want development branches to be deployed to the public!). We point this action to the <code>build/distributions</code> folder, which is where building a Kotlin/JS project creates the final <code>.js</code> and <code>.html</code> artifacts.</li></ul><p><strong>TL;DR</strong>: This workflow <strong>builds and tests all commits and pull requests</strong> – if the commit is on the <code>master</code> or <code>main</code> branch, the changes are prepared for <strong>publishing via Pages</strong>.</p><h3 id=committing-the-workflow-file>Committing the workflow file</h3><p>To enable our newly created workflow in the GitHub project, we <strong>commit and push</strong> our new <code>build-and-publish-kjs.yml</code>.</p><p>If you do this via IntelliJ IDEA&rsquo;s &ldquo;Commit and Push&rdquo; functionality, please note that, depending on how your GitHub account is authenticated, you may encounter the following error when pushing a commit containing workflow files to your GitHub repository:</p><pre tabindex=0><code>error: failed to push some refs to &#39;https://github.com/SebastianAigner/kotlin-js-on-github-pages.git&#39;
To https://github.com/SebastianAigner/kotlin-js-on-github-pages.git
!	refs/heads/master:refs/heads/master	[remote rejected] (refusing to allow an OAuth App to create or update workflow `.github/workflows/build-and-publish-kjs.yml` without `workflow` scope)
Done
</code></pre><p>This is because of an OAuth issue with GitHub requiring a specific scope to push workflow-modifying commits. You can find more info on it and <a href=https://youtrack.jetbrains.com/issue/IDEA-247361>vote on it here</a>. Instead, you can commit the code via the terminal integrated in IntelliJ IDEA, using <code>git push origin master</code>:</p><p><img src=/assets/kotlin-js-on-gh-pages/h3rijixf4qmhfsezqpc4.png alt=git-push-origin-master></p><p>Once the push has finished, we can watch the progress of our Kotlin/JS application being built and prepared for publishing in the &ldquo;Actions&rdquo; tab of our GitHub repository.</p><p><img src=/assets/kotlin-js-on-gh-pages/ztnb7qdc5qpk4phezuqa.png alt=action_running></p><h2 id=setting-up-github-pages-a-namegh-pages-setupa>Setting up GitHub Pages <a name=gh-pages-setup></a></h2><p>After it finished, the workflow we created and triggered in the previous section put our final <code>.js</code> and <code>.html</code> artifacts on the <code>gh-pages</code> branch of our repository, just as we planned:</p><p><img src=/assets/kotlin-js-on-gh-pages/r6lhyhlsxutuk9tux4oh.png alt=gh-pages-branch></p><p>It&rsquo;s time to <strong>enable the GitHub Pages feature</strong> of our repository, and point it to this branch. We can do this using the &ldquo;Settings&rdquo; tab.</p><p>Somewhere close to the bottom, we can find a section labelled &ldquo;GitHub Pages&rdquo;. We select the <code>gh-pages</code> branch and <code>/ (root)</code> (default) and hit &ldquo;Save&rdquo;:</p><p><img src=/assets/kotlin-js-on-gh-pages/66pf58m8og9xrbnzg01z.png alt=github-pages-enable></p><p>After saving our changes, scrolling back to this section reveals the <strong>URL under which our application is available</strong>. (I have previously set up a custom domain for GitHub pages, so this one is used by default.) If you don&rsquo;t have a <a href=https://docs.github.com/en/github/working-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site>custom configuration</a>, the URL of your application usually takes the shape of <code>&lt;username>.github.io/&lt;reponame></code>. Visiting this URL shows our Kotlin/JS application in all its glory, and for the world to see:</p><p><img src=/assets/kotlin-js-on-gh-pages/xr3ooqc9l4rgrpjia265.png alt="ready to be published"></p><p>You can use this link to <strong>share your Kotlin/JS application</strong> with friends and colleagues, or post it on your favorite news aggregator and wait for the upvotes to roll in! 😉</p><p>(If your project is located in a private repository, you might want to change the GitHub Pages visibility. You can find more info on this in the <a href=https://docs.github.com/en/github/working-with-github-pages/changing-the-visibility-of-your-github-pages-site>GitHub docs</a>.)</p><h2 id=take-your-project-for-a-spin>Take your project for a spin!</h2><p>We&rsquo;re done! From now on, whenever you push code, your project will automatically be built on GitHub&rsquo;s CI servers. If a commit is faulty, you can see so on the web interface – and you will even be reminded via email!</p><p><img src=/assets/kotlin-js-on-gh-pages/hvu8r28kptsqq99ys2rd.png alt="checks failed"></p><p>Pushing to the main branch of the repository means your page (which is reachable at <code>&lt;username>.github.io/&lt;reponame></code>) will <strong>automatically</strong> be updated.</p><p>And when somebody makes a pull request, build and test status is also shown <strong>directly in context</strong>:</p><p><img src=/assets/kotlin-js-on-gh-pages/u3wl5tcsahepdma6pbbq.png alt="pr failed"></p><h2 id=thank-you>Thank you!</h2><p>I hope you found this post useful. <a href=https://github.com/features/actions>GitHub Actions</a> is a <strong>powerful, but also complex tool</strong>, and I hope that these instructions make it a bit easier to get started together with Kotlin/JS. You can find the <a href=https://github.com/SebastianAigner/kotlin-js-on-gh-pages>sample project I used</a> to create the screenshots for this tutorial on GitHub as well, and use it as a source of inspiration or template for a future project.</p><p>If you&rsquo;re interested in similar content, consider <strong>giving me a follow</strong> to stay up to date.</p><p><em>Special thanks to <a href=https://twitter.com/hszanowski>Jakub Chrzanowski</a> for sharing some of his CI wisdom with me for this blog post.</em>!</p><div><div>Tags:</div><ul><li><a href=/tags/kotlin/>kotlin</a></li><li><a href=/tags/javascript/>javascript</a></li><li><a href=/tags/github/>github</a></li><li><a href=/tags/webdev/>webdev</a></li></ul></div></div></div></main><footer><footer class="site-footer h-card"><data class=u-url href></data><div class=wrapper><div class=footer-col-wrapper><div class=footer-col><p class=feed-subscribe><svg class="svg-icon orange"/><span>Subscribe</span></a></p><ul class=contact-list></ul></div><div class=footer-col><p>Thanks for stopping by my corner of the internet :)</p></div></div></div></footer></footer></body></html>