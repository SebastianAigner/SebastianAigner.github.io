<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Running Create-React-Kotlin-App on Heroku | Sebastian Aigner</title><link rel=stylesheet href=https://sebi.io/sass/main.1062dd691b84b3ea042cce5aecb22abbae6d1a58288b48fbcb72443c8f1930dd.css integrity="sha256-EGLdaRuEs+oELM5a7LIqu65tGlgoi0j7y3JEPI8ZMN0=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header class=site-header><div class=wrapper><a class=site-title rel=author href=/>Sebastian Aigner</a><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg viewBox="0 0 18 15" width="18" height="15"><path d="M18 1.484c0 .82-.665 1.484-1.484 1.484H1.484C.665 2.969.0 2.304.0 1.484.0.665.665.0 1.484.0h15.032C17.335.0 18 .665 18 1.484zm0 6.032C18 8.335 17.335 9 16.516 9H1.484C.665 9 0 8.335.0 7.516c0-.82.665-1.484 1.484-1.484h15.032C17.335 6.031 18 6.696 18 7.516zm0 6C18 14.335 17.335 15 16.516 15H1.484C.665 15 0 14.335.0 13.516c0-.82.665-1.483 1.484-1.483h15.032C17.335 12.031 18 12.695 18 13.516z"/></svg></span></label><div class=trigger><a class=page-link href=/>Home</a>
<a class=page-link href=/micro/>Microblah</a>
<a class=page-link aria-current=true class=ancestor href=/posts/>Posts</a>
<a class=page-link href=/tags/>Tags</a></div></nav></div></header><main class=page-content aria-label=Content><div class=wrapper><header class=post-header><h1 class="post-title p-name" itemprop="name headline">Running Create-React-Kotlin-App on Heroku</h1><p class=post-meta><time class=dt-published datetime=2018-09-10T19:33:57+00:00>September 10, 2018</time></p></header><div class="post-content e-content"><p><em>(This post is a tutorialized version of the workarounds that I worked out together with Andrey Skladchikov in <a href=https://youtrack.jetbrains.com/issue/CRKA-88>this YouTrack issue</a> for CRKA.)</em></p><p>As the name might suggest, <code>create-react-kotlin-app</code> (CRKA) is the Kotlin equivalent of JavaScript&rsquo;s <code>create-react-app</code>: A wonderful little tool to automate all the webpack and configuration stuff for your React/Kotlin application, having you focus completely on the actual application logic.</p><p><strong>Getting create-react-kotlin-app to run on Heroku</strong>, however, is not without its pitfalls. After having struggled through it myself, I&rsquo;ll run you through how you can deploy your CRKA application on Heroku, proper production builds and all.</p><h3 id=prerequisites>Prerequisites</h3><p>I assume that you already have a <code>create-react-kotlin-app</code> set up and are just wondering how to deploy it right now. If that&rsquo;s not the case, check the official <a href=https://github.com/JetBrains/create-react-kotlin-app/blob/master/README.md#quick-overview>README</a> on how to set up your app, and check the excellent <a href=https://devcenter.heroku.com/articles/creating-apps>Heroku DevCenter</a> for instructions how to initialize your application.</p><h3 id=the-issue>The Issue</h3><p>Without the right configuration, you are met with a variety of error messages when executing <code>git push heroku master</code>. For example:</p><h4 id=enoent-issues-with-iml-files>ENOENT Issues with IML files</h4><pre tabindex=0><code>remote:        &gt; react-scripts-kotlin gen-idea-libs
remote:        
remote:        fs.js:646
remote:        return binding.open(pathModule._makeLong(path), stringToFlags(flags), mode);
remote:        ^
remote:        
remote:        Error: ENOENT: no such file or directory, open &#39;/tmp/build_9563fc6e00a90c3546f23ef114418ef3/build_9563fc6e00a90c3546f23ef114418ef3.iml&#39;
remote:        at Object.fs.openSync (fs.js:646:18)
remote:        at Object.fs.readFileSync (fs.js:551:33)
</code></pre><p>(this is referenced in <a href=https://youtrack.jetbrains.com/issue/CRKA-89>CRKA-89</a>)</p><h3 id=proper-set-up>Proper Set-Up</h3><p>Let&rsquo;s first resolve the <code>ENOENT</code> issues by opening our <code>package.json</code> and removing the line that says <code>"postinstall": "npm run gen-idea-libs"</code>, leaving you with a config looking similar to this:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#fb4934>&#34;name&#34;</span>: <span style=color:#b8bb26>&#34;blogexample&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#fb4934>&#34;version&#34;</span>: <span style=color:#b8bb26>&#34;0.1.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#fb4934>&#34;private&#34;</span>: <span style=color:#fe8019>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#fb4934>&#34;dependencies&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;core-js&#34;</span>: <span style=color:#b8bb26>&#34;^2.5.7&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;react&#34;</span>: <span style=color:#b8bb26>&#34;^16.5.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;react-dom&#34;</span>: <span style=color:#b8bb26>&#34;^16.5.0&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#fb4934>&#34;devDependencies&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;react-scripts-kotlin&#34;</span>: <span style=color:#b8bb26>&#34;2.1.12&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#fb4934>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;start&#34;</span>: <span style=color:#b8bb26>&#34;react-scripts-kotlin start&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;build&#34;</span>: <span style=color:#b8bb26>&#34;react-scripts-kotlin build&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;eject&#34;</span>: <span style=color:#b8bb26>&#34;react-scripts-kotlin eject&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;gen-idea-libs&#34;</span>: <span style=color:#b8bb26>&#34;react-scripts-kotlin gen-idea-libs&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#fb4934>&#34;get-types&#34;</span>: <span style=color:#b8bb26>&#34;react-scripts-kotlin get-types --dest=src/types&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Don&rsquo;t forget to remove the trailing comma on the line above the one you deleted, otherwise you will be left with invalid JSON!</strong></p><p>After a <code>git add .</code> and respectively a <code>git commit</code>, the build actually succeeds. But when accessing the site, you are greeted with a compile error!</p><pre tabindex=0><code>Failed to compile.
multi ./node_modules/react-dev-utils/webpackHotDevClient.js ./node_modules/react-scripts-kotlin/config/polyfills.js kotlinApp
Module not found: Can&#39;t resolve &#39;kotlinApp&#39; in &#39;/app&#39;
</code></pre><p><img src=/assets/crka-heroku/compile_error-6602472.png alt=compile_error-6602472></p><p><em><center>Things you don&rsquo;t want to see</center></em></p><p>Despite the cryptic error message, this is actually because there is <strong>no JDK installed on Heroku</strong> by default! (See also <a href=https://github.com/mars/create-react-app-buildpack/issues/85>this related issue</a>).</p><p>This is solved by performing</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>heroku buildpacks:add -i <span style=color:#d3869b>1</span> https://github.com/heroku/heroku-buildpack-jvm-common.git
</span></span></code></pre></div><p><strong>Attention! It might be tempting to just quit the tutorial here as the app is technically running, BUT</strong> as the output of <code>heroku logs --tail</code> will tell you:</p><pre tabindex=0><code>Compiled successfully!

You can now view blogexample in the browser.
Local:            http://localhost:18186/
On Your Network:  http://172.18.XX.XX:18186/

Note that the development build is not optimized.
To create a production build, use npm run build.
</code></pre><h3 id=automatic-production-builds>Automatic Production Builds</h3><p>Thankfully, replacing this development server with an actual production server is rather simple on Heroku when using the <a href=https://elements.heroku.com/buildpacks/mars/create-react-app-buildpack>create-react-app-buildpack</a>! To use it as a drop-in-replacement for the default <code>nodejs</code> buildpack shipped by Heroku, run:</p><div class=highlight><pre tabindex=0 style=color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>heroku buildpacks:add https://github.com/mars/create-react-app-buildpack.git
</span></span><span style=display:flex><span>heroku buildpacks:remove heroku/nodejs
</span></span></code></pre></div><p>Perform a new commit and push, and you will immediatly notice that the build takes a lot longer. This is because an actual production build is now created once, speeding up all subsequent pageloads immensely (yes, even on the dynos that go to sleep, like in Heroku&rsquo;s free tier!).</p><p><strong>Congratulations, you now have a properly configured Create-React-Kotlin-App deployment on Heroku!</strong> It will behave exactly as you would like from a Heroku application, rebuilding whenever you push a new commit, and always keeping the production build optimized.</p><h3 id=what-to-do-when-further-issues-arise>What to do when further issues arise</h3><p>I am deeply grateful to the people in the <a href=https://youtrack.jetbrains.com/issues/CRKA>official YouTrack issue tracker</a> answering questions with such dedication. If you run into problems, use the YouTrack search bar and try to see if there is an issue that already solves your problem.</p><p><strong>If you&rsquo;re excited about these technologies, why not also drop me a line or a tweet?</strong> I&rsquo;d love to hear how you are using CRKA to build cool applications!</p><p>As a footnote, here&rsquo;s a somewhat relevant excerpt of the (now succeeding) build log in all its glory:</p><pre tabindex=0><code>remote: =====&gt; Downloading Buildpack: https://github.com/mars/create-react-app-inner-buildpack.git
remote: =====&gt; Detected Framework: React.js (create-react-app)
remote:        Writing `static.json` to support create-react-app
remote:        Enabling runtime environment variables
remote: 
remote: &gt; blogexample@0.1.0 build /tmp/build_c677b5a5cd4e5915e884848517a4231e
remote: &gt; react-scripts-kotlin build
remote: 
remote: Creating an optimized production build...
remote: Compiled successfully.
remote: 
remote: File sizes after gzip:
remote: 
remote:   78.53 KB  build/static/js/main.bf1ecf02.js
remote:   441 B     build/static/css/main.25153e8e.css
remote: 
remote: The project was built assuming it is hosted at the server root.
remote: You can control this with the homepage field in your package.json.
remote: For example, add this to build it for GitHub Pages:
remote: 
remote:   &#34;homepage&#34; : &#34;http://myname.github.io/myapp&#34;,
remote: 
remote: The build folder is ready to be deployed.
remote: You may serve it with a static server:
remote: 
remote:   npm install -g serve
remote:   serve -s build
remote: 
remote: Find out more about deployment here:
remote: 
remote:   http://bit.ly/2vY88Kr
remote: 
remote: =====&gt; Downloading Buildpack: https://github.com/heroku/heroku-buildpack-static.git
remote: =====&gt; Detected Framework: Static HTML
remote:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
remote:                                  Dload  Upload   Total   Spent    Left  Speed
remote: 100  838k  100  838k    0     0  6112k      0 --:--:-- --:--:-- --:--:-- 6121k
remote: -----&gt; Installed directory to /app/bin
remote: Using release configuration from last framework (Static HTML).
remote: -----&gt; Discovering process types
remote:        Procfile declares types     -&gt; (none)
remote:        Default types for buildpack -&gt; web
remote: 
remote: -----&gt; Compressing...
remote:        Done: 124.4M
remote: -----&gt; Launching...
remote:        Released v5
</code></pre></div></div></main><footer><footer class="site-footer h-card"><data class=u-url href></data><div class=wrapper><div class=footer-col-wrapper><div class=footer-col><p class=feed-subscribe><svg class="svg-icon orange"/><span>Subscribe</span></a></p><ul class=contact-list></ul></div><div class=footer-col><p>Thanks for stopping by my corner of the internet :)</p></div></div></div></footer></footer></body></html>