<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Hexagonal Grids</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/general/2018/01/04/Hexagonal-Coordinate-Systems.html">
  <link rel="alternate" type="application/rss+xml" title="sebi.io" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">sebi.io</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Hexagonal Grids</h1>
    <p class="post-meta">
      <time datetime="2018-01-04T01:23:43+01:00" itemprop="datePublished">
        
        Jan 4, 2018
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

<p>I was spending one of the recent days in the Loretta Bar here in Munich together with Alex, and we worked on a few tasks of the 2017 edition of Advent of Code. I was infatuated with the last task we worked on, the <a href="http://adventofcode.com/2017/day/11">Day 11</a> challenge. You are supposed to find the distance of a position in a <a href="https://en.wikipedia.org/wiki/Hexagonal_tiling">Hex Grid</a> based on a path description. I had already read a few articles regarding hexagonal grids, because I feel it is one of the less intuitive data structures, but none of them really made me understand the topic extremely well. I decided to just grab a pen and doodle away at a napkin and (later on) a few pieces of paper, scribbling around and trying to figure things out. After I had managed to build an (albeit inefficient) solution for myself, I set out to understand more about the topic. When I managed to have somewhat of a personal breakthrough in understanding, and felt a lot better reasoning about the topic, I decided it would be time to improve upon the visualisations that I had seen on other blogs like <a href="https://www.redblobgames.com/grids/hexagons/">Redblobgames</a>. They‚Äôre still a great read any heavily recommended, but I thought I‚Äôd try my hand at one of these as well. So, amidst what seems like a heavy outage on the internet (with a very spotty connection), I managed to glue together a small demo. Because we all love interactivity, I‚Äôm going to throw the demo in first, and the rest of the text later.</p>

<h3 id="interactive-demo">Interactive demo</h3>
<script src="http://localhost:4000/assets/unity_hexagons/TemplateData/UnityProgress.js"></script>

<script src="http://localhost:4000/assets/unity_hexagons/Build/UnityLoader.js"></script>

<script>
  var gameInstance = UnityLoader.instantiate("gameContainer", "http://localhost:4000/assets/unity_hexagons/Build/newbuilds.json", {onProgress:UnityProgress});
</script>

<div class="webgl-content">
  <div id="gameContainer" style="width: 100%; height: 423px"></div>
</div>
<p>This demo was built on one evening after being kept awake by one too many please-allow-me-to-stay-here-longer-espressos in the caf√©. Thanks for letting us stay!</p>

<h3 id="on-hexagonal-grids">On Hexagonal Grids</h3>
<p>Unlike regular grids, I‚Äôve struggled a bit at first with understanding how I would map hexagons to arrays. I‚Äôve since realised that you can easily map hexagons into 3 dimensions, and even two dimensions isn‚Äôt a problem. The general idea that this approach is following is cube coordinates. If you play around with the demo (and maybe switch the camera), you‚Äôll quickly see that looked at from the right angle, a diagonal ‚Äúplane‚Äù of 3d cubes looks an awful lot like a hex grid. This is what we are going to use to reason about how to distribute coordinates, measure distances, and so on.</p>
<h4 id="coordinates-and-constraints">Coordinates (and Constraints)</h4>
<p>To make our lives a little easier, we choose the plane that satisfies the basic constraint</p>

<script type="math/tex; mode=display">x + y + z = 0</script>

<p>If you play around with the interactive widget up there, you‚Äôll quickly realize that all coordinates on the plane displayed fulfill exactly that equation. It should also give you an intuitive idea what parameters should change when you perform a move in a direction.</p>

<h4 id="distances">Distances</h4>
<p>The 3D representation allows us to easily reason about distances in the grid. You can see that to each neighbouring <em>cube</em>, the manhattan distance is 2. In the <em>hex grid</em>, the distance would be one. Check for yourself that this is correct for all neighbours of the initial \(0,0,0\) coordinate.</p>

<p>Thus, we quickly arrive at a concise formula for determining distances of hexagons in the grid in relation to the origin:</p>

<script type="math/tex; mode=display">d = \frac{|x|+|y|+|z|}{2}</script>

<h4 id="the-obsolete-third-axis">The obsolete third axis</h4>
<p>But, we can go even further. If we can assume that the formula \(x+y+z = 0\) holds for all our cubes, can simply do some middle school maths and arrive at</p>

<script type="math/tex; mode=display">z = -(x+y)</script>

<p>So what does this tell us? Since the \(z\) coordinate is merely a function of \(x\) and \(y\), it does not need to be saved in memory, but can be calculated on demand (when it makes sense). This also means that our distance is only dependent on the values of \(x\) and \(y\):</p>

<script type="math/tex; mode=display">d = \frac{|x|+|y|+ |-(x+y)|}{2} = \frac{|x|+|y|+ |x+y|}{2}</script>

<p>If we go back to the graphical representation again (after having developed some intuition for it), we can see that this makes an extreme amount of sense. Observe how each \(x,y\) coordinate pair already uniquely identifies a cube on our plane. The formula for \(z\) also holds; again, staring intently at the cubes and axis offsets should give you an intuitive understanding to why that is (<em>Looking at it from the default camera perspective, you should realise that moving one cube away from the camera (into the space) always has to increment the \(z\) coordinate by one due to the staircase like nature of our plane; conversely, you need to decrease your \(z\) coordinate whenever you move towards the camera</em>)</p>

<p>So, we can store all grid coordinates in only two dimensions - that‚Äôs going to make building implementations a lot easier!</p>

<h4 id="a-demo-implementation">A demo implementation</h4>
<p>In my <a href="https://github.com/SebastianAigner/advent-of-code-2017-ocaml/blob/master/day11/Day11.kt">Advent of Code</a> repository, you can find two implementations for the <code class="highlighter-rouge">HexVector</code> interface which I decided needed to be implemented in order to solve the task given by the AoC challenge. The first version, <code class="highlighter-rouge">HexVector3</code>, is a quite low performance prototype that I came up with then and there in the caf√©. It uses a process of <em>coordinate normalisation</em> (leveraging the fact that certain pairs of distances can be fused together into other coordinates, as to always obtain the correct manhattan distance).</p>

<p>The second version, <code class="highlighter-rouge">HexVector2</code>, implements the same interface using only two coordinates, while also allowing a conversion to <code class="highlighter-rouge">HexVector3</code>.</p>

<p>It‚Äôs coding challenge code, so it‚Äôs not the most polished thing in the world, but I‚Äôm sure it‚Äôll get the point across üòÅ</p>

<h4 id="further-reading">Further reading</h4>
<p>This is by no means a complete guide on how to work with hex grids, and it‚Äôs obviously not supposed to be. It should merely serve as some additional material for those who enjoy interactive visualisations. Hope it helps some of you! If you want to know more about hexagonal grids, I suggest you have a look at these two resources (amongst whatever else you will find on your quest):</p>
<ul>
  <li><a href="https://www.redblobgames.com/grids/hexagons/">Redblobgames</a></li>
  <li><a href="http://keekerdc.com/2011/03/hexagon-grids-coordinate-systems-and-distance-calculations/">Keekerdc</a></li>
</ul>

<h3 id="how-this-demo-is-made">How this Demo is made</h3>
<p>I first wanted to have a non-interactive 3D model so I could just have a look at it properly (looking on crumpled papers with lines all over the place trying to indicate the third dimension got tiring after a while), so I fired up blender, which is when I had the idea that I could also use a realtime 3D game engine to visualise what I had in mind. I‚Äôd already played around with Unity a bit beforehand, and a demo world was quickly assembled. I grabbed myself a camera controller script that allows orbiting and zooming, and built a script that would highlight the cube/hex that the mouse is currently resting on. I‚Äôve had some trouble getting the line renderer to work (which is responsible for drawing the coordinates), but after a short change in the materials setting, that worked as well. After that, I only had to figure out how to properly scale the UI, and was able to export once and for all!</p>

<p>Unity is probably a bit overkill for the amount of things that are actually happening in the demo, but it allowed me to do some very rapid and caffeine driven prototyping. ‚òï</p>

<p>Also, as a small easter egg: the backdrop/skybox is my old office where I worked at TUM - just if anybody is interested in that üòä.</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">sebi.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              sebi.io
            
            </li>
            
            <li><a href="mailto:[firstname] d√∂t [lastname]@me.com">[firstname] d√∂t [lastname]@me.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/SebastianAigner"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">SebastianAigner</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/TrueSebi"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">TrueSebi</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>This is my corner of the internet. Tech makes me happy, so I try to note down and share my adventures here. I don&#39;t have a really specific plan on where I am going with this, so I&#39;ll use it as my notepad to jot down ideas, concepts, and tutorials, so that I and others will be able to revisit them whenever they&#39;d like.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
