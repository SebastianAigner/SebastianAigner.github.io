<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Setting up a CUPS / AirPrint Server on Raspberry Pi | sebi.io</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Setting up a CUPS / AirPrint Server on Raspberry Pi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Even though I’ve switched almost my whole office experience to paperless, my parents are still very much heavy users of the printer. However, with the recent diversification of even their technology, and the growing need to print from a Windows machine, a Macbook and an iPad, I knew it was necessary to find a unified way to print from all those devices. The answer proved to be a CUPS (formerly Common UNIX Printing System) server on a Raspberry Pi that I had lying around." />
<meta property="og:description" content="Even though I’ve switched almost my whole office experience to paperless, my parents are still very much heavy users of the printer. However, with the recent diversification of even their technology, and the growing need to print from a Windows machine, a Macbook and an iPad, I knew it was necessary to find a unified way to print from all those devices. The answer proved to be a CUPS (formerly Common UNIX Printing System) server on a Raspberry Pi that I had lying around." />
<link rel="canonical" href="http://localhost:4000/jekyll/update/2017/12/18/setting-up-cups-server.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/update/2017/12/18/setting-up-cups-server.html" />
<meta property="og:site_name" content="sebi.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-12-18T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Setting up a CUPS / AirPrint Server on Raspberry Pi" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2017-12-18T00:00:00+01:00","datePublished":"2017-12-18T00:00:00+01:00","description":"Even though I’ve switched almost my whole office experience to paperless, my parents are still very much heavy users of the printer. However, with the recent diversification of even their technology, and the growing need to print from a Windows machine, a Macbook and an iPad, I knew it was necessary to find a unified way to print from all those devices. The answer proved to be a CUPS (formerly Common UNIX Printing System) server on a Raspberry Pi that I had lying around.","headline":"Setting up a CUPS / AirPrint Server on Raspberry Pi","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/update/2017/12/18/setting-up-cups-server.html"},"url":"http://localhost:4000/jekyll/update/2017/12/18/setting-up-cups-server.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="sebi.io" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">sebi.io</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Setting up a CUPS / AirPrint Server on Raspberry Pi</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-12-18T00:00:00+01:00" itemprop="datePublished">Dec 18, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Even though I’ve switched almost my whole office experience to paperless, my parents are still very much heavy users of the printer. However, with the recent diversification of even their technology, and the growing need to print from a Windows machine, a Macbook and an iPad, I knew it was necessary to find a unified way to print from all those devices. The answer proved to be a <em>CUPS (formerly Common UNIX Printing System)</em> server on a Raspberry Pi that I had lying around.</p>

<h3 id="prerequisites">Prerequisites</h3>
<p>I set up my Raspberry Pi with the latest version of Raspbian. I made sure the packages <code class="language-plaintext highlighter-rouge">vim</code> and <code class="language-plaintext highlighter-rouge">git</code> are installed on the device (if they are not, you can simply install them via your old friend <code class="language-plaintext highlighter-rouge">apt-get</code>).</p>

<h3 id="installation">Installation</h3>
<p>First, we check whether our printer is actually being recognized by the system (the main prerequisite for the rest of the tutorial to work)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">lsusb</code></pre></figure>

<p>Now that we’ve verified this, we can run</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt-get <span class="nb">install </span>cups</code></pre></figure>

<p>and install the CUPS server and its dependencies. This can take a while.</p>

<p>Next, we modify the user account to properly function with the CUPS authentication:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>usermod <span class="nt">-aG</span> lpadmin pi</code></pre></figure>

<p>This concludes the installation. Now all we need to do is to configure the web frontend to be accessible.</p>

<h3 id="configuration">Configuration</h3>
<p>Now, it’s time to set up the cofiguration of your CUPS service to be available outside of localhost. So, fire up your favorite text editor (in my case <code class="language-plaintext highlighter-rouge">vim</code>, but feel free to go full <code class="language-plaintext highlighter-rouge">emacs</code> or <code class="language-plaintext highlighter-rouge">nano</code> if you prefer), and open <code class="language-plaintext highlighter-rouge">/etc/cups/cupsd.conf</code>.</p>

<p>Find the line that says</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Listen localhost:631
</code></pre></div></div>

<p>and replace it with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Port 631
</code></pre></div></div>

<p>At the first block, set</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WebInterface Yes
ServerAlias *
</code></pre></div></div>

<p>afterwards, set all the <code class="language-plaintext highlighter-rouge">Allow @local</code> annotations for the locations block, like so:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt; Location / &gt;
	# Restrict access to the server...
	Order allow,deny
	Allow @local
	&lt; /Location &gt;
	
	&lt; Location /admin &gt;
	# Restrict access to the admin pages...
	Order allow,deny
	Allow @local
	&lt; /Location &gt;
	
	&lt; Location /admin/conf &gt;
	AuthType Default
	Require user @SYSTEM
	
	# Restrict access to the configuration files...
	Order allow,deny
	Allow @local
	&lt; /Location &gt;
</code></pre></div></div>

<p>If you’ve followed the steps above, you’re pretty much done with your installation; restart the CUPS server by invoking <code class="language-plaintext highlighter-rouge">sudo /etc/init.d/cups restart</code>.</p>

<p>You can now add the printer via the webinterface; the login will be the same as it is for your Raspbian installation.</p>

<h3 id="but-what-about-airprint">But what about AirPrint?</h3>

<p>To setup AirPrint, we need to install another package called <code class="language-plaintext highlighter-rouge">avahi-discover</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt-get <span class="nb">install </span>avahi-discover</code></pre></figure>

<p>And we are done… kind of.</p>

<h3 id="troubleshooting-rgb-printer-issues">Troubleshooting RGB Printer Issues</h3>

<p>In my case, when printing some documents, the printer would just not run. A short investigation in the web interface would reveal the issue:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"(urftopdf) die(Invalid ColorSpace, only RGB 24BIT type 1 is supported) [Success]"
</code></pre></div></div>
<p>Nothing like a <code class="language-plaintext highlighter-rouge">[Success]</code> error message, am I right? I dug deep into some ancient forums and figured out that the <code class="language-plaintext highlighter-rouge">urftopdf</code> that comes bundled with CUPS apparently is not the most current version, and that it lacks the support for the color space I was requiring. So, I decided to <em>compile my own urftopdf</em>! What might sound daunting at first is actually quite straightforward and can be done with the few commands below:</p>

<p>First, we grab ourselves a version of urftopdf which actually supports the colorspace we need:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">git clone https://github.com/superna9999/urftopdf</code></pre></figure>

<p>Then, we install a few dependencies without which the compilation is destined to fail:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt-get <span class="nb">install </span>libhpdf-dev libcups2-dev libcupsimage2-dev g++ cups-client</code></pre></figure>

<p>Now, we <code class="language-plaintext highlighter-rouge">cd</code> into the <code class="language-plaintext highlighter-rouge">urftopdf</code> folder and execute the <code class="language-plaintext highlighter-rouge">make</code> command. Now, all that is left is to back up our old <code class="language-plaintext highlighter-rouge">urftopdf</code> installation and replace it with the new one, which is merely two lines to enter:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo mv</span> /usr/lib/cups/filter/urftopdf /usr/lib/cups/filter/urftopdf.old
<span class="nb">sudo cp </span>urftopdf /usr/lib/cups/filter</code></pre></figure>

<p>This should take effect immediately - if it doesn’t, restart CUPS using the command mentioned above, and everything should be great.</p>

<p>Installing the printers under Windows and Mac should be a breeze, iOS devices should autodiscover the devices.</p>

<h3 id="advantages-and-drawbacks">Advantages and Drawbacks</h3>
<p>After having deployed this solution for a while, I’ve noticed a few drawbacks, but also advantages. Printing from a Windows machine <em>flies</em>, it is the same speed as if you would just have the printer attached to the machine directly. From Apple based devices, the CUPS server has to do some recomputations, which take a long time. When printing a page that is only 5 pages long and does not have too many complex SVG shapes, this is fine - so if your main use case is just printing out an email or an excerpt from Wikipedia. However, when printing very complex documents (e.g. a mindmap you drew on your iPad) that has a lot of small individual shapes, or a document that is very long (if you’re on a tree killing spree and print out your ebooks), you’ll have an unfeasibly long wait time.</p>

  </div><a class="u-url" href="/jekyll/update/2017/12/18/setting-up-cups-server.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">sebi.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">sebi.io</li><li><a class="u-email" href="mailto:[firstname] döt [lastname]@me.com">[firstname] döt [lastname]@me.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/SebastianAigner"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">SebastianAigner</span></a></li><li><a href="https://www.twitter.com/TrueSebi"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">TrueSebi</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is my corner of the internet. Tech makes me happy, so I try to note down and share my adventures here. I don&#39;t have a really specific plan on where I am going with this, so I&#39;ll use it as my notepad to jot down ideas, concepts, and tutorials, so that I and others will be able to revisit them whenever they&#39;d like.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
